#!/bin/bash
# TunaCode Recursive Branch Launcher
# This ensures we always use the correct version with venv

# Get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Change to the project directory
cd "$SCRIPT_DIR"

# Check if we're on the correct branch
CURRENT_BRANCH=$(git branch --show-current 2>/dev/null)
if [ "$CURRENT_BRANCH" != "feature/recursive-task-execution" ]; then
    echo "‚ö†Ô∏è  Warning: Not on recursive branch (current: $CURRENT_BRANCH)"
    echo "Switching to feature/recursive-task-execution..."
    git checkout feature/recursive-task-execution
fi

# Activate virtual environment and run TunaCode
if [ -f "venv/bin/activate" ]; then
    source venv/bin/activate
    echo "üöÄ Running TunaCode v0.0.41 (Recursive Branch)"
    echo "   Features: Multi-turn recursive decomposition enabled"
    echo ""
    exec /root/tunacode/venv/bin/tunacode "$@"
else
    echo "‚ùå Error: Virtual environment not found!"
    echo "Please run: python3 -m venv venv && pip install -e '.[dev]'"
    exit 1
fi